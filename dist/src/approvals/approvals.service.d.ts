import { PrismaService } from '../prisma/prisma.service';
import { DocumentsService } from '../documents/documents.service';
export type ApprovalCategory = 'procedures' | 'certifications' | 'instructions';
export type ApprovalStatus = 'pending' | 'approved' | 'denied';
export type ApprovalItem = {
    id: string;
    code?: string;
    name: string;
    category: ApprovalCategory;
    status?: ApprovalStatus | string;
    requestedAt?: string;
    updatedAt?: string;
    reviewer?: {
        id: string;
        name: string;
        email: string;
    };
    responsible?: {
        id: string;
        name: string;
        email: string;
    };
    procedureTitle?: string;
    documentVersion?: string;
    documentResume?: string;
    aiProcessingStatus?: string;
};
export declare class ApprovalsService {
    private readonly prisma;
    private readonly documentsService;
    constructor(prisma: PrismaService, documentsService: DocumentsService);
    private resolveVersionCreator;
    private resolveDocumentCreator;
    createDocumentApproval(params: {
        procedureId: string;
        documentId: string;
        reviewerId: string;
        responsibleId?: string;
        documentVersionId?: string;
        notifyEmail?: boolean;
        notifyWhatsapp?: boolean;
    }): Promise<{
        procedure: {
            id: string;
            title: string;
            code: string | null;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string | null;
            description: string | null;
            plantId: string | null;
            processId: string | null;
            subprocessId: string | null;
            gerente: string | null;
            reviewerId: string | null;
            responsibleId: string | null;
            notifyEmail: boolean;
            notifyWhatsapp: boolean;
            obsoleteDate: Date | null;
            procedureApprovalStatus: string;
            procedureApprovedAt: Date | null;
            procedureApprovedBy: string | null;
            lastDistributedAt: Date | null;
        };
        document: {
            id: string;
            code: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            procedureId: string;
        } | null;
        responsible: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        } | null;
        reviewer: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        };
    } & {
        id: string;
        status: string;
        createdAt: Date;
        updatedAt: Date;
        documentId: string | null;
        reviewerId: string;
        responsibleId: string | null;
        notifyEmail: boolean;
        notifyWhatsapp: boolean;
        procedureId: string;
        documentVersionId: string | null;
        approvalDate: Date | null;
        rejectionReason: string | null;
    }>;
    syncPendingApprovals(): Promise<void>;
    getReviewerApprovals(params: {
        reviewerId: string;
        status?: ApprovalStatus;
    }): Promise<({
        procedure: {
            id: string;
            title: string;
            code: string | null;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string | null;
            description: string | null;
            plantId: string | null;
            processId: string | null;
            subprocessId: string | null;
            gerente: string | null;
            reviewerId: string | null;
            responsibleId: string | null;
            notifyEmail: boolean;
            notifyWhatsapp: boolean;
            obsoleteDate: Date | null;
            procedureApprovalStatus: string;
            procedureApprovedAt: Date | null;
            procedureApprovedBy: string | null;
            lastDistributedAt: Date | null;
        };
        responsible: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        } | null;
        reviewer: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        };
    } & {
        id: string;
        status: string;
        createdAt: Date;
        updatedAt: Date;
        documentId: string | null;
        reviewerId: string;
        responsibleId: string | null;
        notifyEmail: boolean;
        notifyWhatsapp: boolean;
        procedureId: string;
        documentVersionId: string | null;
        approvalDate: Date | null;
        rejectionReason: string | null;
    })[]>;
    approveDocument(params: {
        approvalId: string;
        user?: {
            sub?: string;
            id?: string;
            firstName?: string;
            lastName?: string;
            areas?: string[];
            roleLevels?: string[];
            roles?: string[];
            permissions?: string[];
        };
    }): Promise<{
        procedure: {
            id: string;
            title: string;
            code: string | null;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string | null;
            description: string | null;
            plantId: string | null;
            processId: string | null;
            subprocessId: string | null;
            gerente: string | null;
            reviewerId: string | null;
            responsibleId: string | null;
            notifyEmail: boolean;
            notifyWhatsapp: boolean;
            obsoleteDate: Date | null;
            procedureApprovalStatus: string;
            procedureApprovedAt: Date | null;
            procedureApprovedBy: string | null;
            lastDistributedAt: Date | null;
        };
        responsible: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        } | null;
        reviewer: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        };
    } & {
        id: string;
        status: string;
        createdAt: Date;
        updatedAt: Date;
        documentId: string | null;
        reviewerId: string;
        responsibleId: string | null;
        notifyEmail: boolean;
        notifyWhatsapp: boolean;
        procedureId: string;
        documentVersionId: string | null;
        approvalDate: Date | null;
        rejectionReason: string | null;
    }>;
    rejectDocument(params: {
        approvalId: string;
        rejectionReason?: string;
    }): Promise<{
        procedure: {
            id: string;
            title: string;
            code: string | null;
            status: string;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string | null;
            description: string | null;
            plantId: string | null;
            processId: string | null;
            subprocessId: string | null;
            gerente: string | null;
            reviewerId: string | null;
            responsibleId: string | null;
            notifyEmail: boolean;
            notifyWhatsapp: boolean;
            obsoleteDate: Date | null;
            procedureApprovalStatus: string;
            procedureApprovedAt: Date | null;
            procedureApprovedBy: string | null;
            lastDistributedAt: Date | null;
        };
        responsible: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        } | null;
        reviewer: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        };
    } & {
        id: string;
        status: string;
        createdAt: Date;
        updatedAt: Date;
        documentId: string | null;
        reviewerId: string;
        responsibleId: string | null;
        notifyEmail: boolean;
        notifyWhatsapp: boolean;
        procedureId: string;
        documentVersionId: string | null;
        approvalDate: Date | null;
        rejectionReason: string | null;
    }>;
    private applyApprovalStamp;
    private parseSignature;
    private streamToBuffer;
    getApprovalDetails(params: {
        approvalId: string;
    }): Promise<{
        id: string;
        status: string;
        createdAt: Date;
        updatedAt: Date;
        approvalDate: Date | null;
        rejectionReason: string | null;
        procedure: {
            id: string;
            title: string;
            description: string | null;
            documents: ({
                versions: ({
                    file: {
                        id: string;
                        storageKey: string;
                        originalName: string;
                        mimeType: string;
                        size: number;
                        fileHash: string | null;
                        category: import("@prisma/client").$Enums.DocumentCategory;
                        entityType: string | null;
                        entityId: string | null;
                        title: string | null;
                        code: string | null;
                        version: string | null;
                        status: string | null;
                        owner: string | null;
                        nextReview: Date | null;
                        ragEnabled: boolean;
                        ragStatus: string | null;
                        aiSummary: string | null;
                        aiResume: string | null;
                        aiTags: string[];
                        aiProcessedAt: Date | null;
                        aiProcessingStatus: string | null;
                        embeddingStatus: string | null;
                        embeddingProcessedAt: Date | null;
                        resumeEmbedding: import("@prisma/client/runtime/client").JsonValue | null;
                        createdAt: Date;
                        updatedAt: Date;
                        aiDocType: string | null;
                        aiSafetyInstructions: string[];
                        aiEquipmentModels: string[];
                        aiPartNumbers: string[];
                        aiVendors: string[];
                        aiMaintenanceIntervals: string[];
                        aiTechnicalSpecs: string[];
                        aiProcedureNames: string[];
                    } | null;
                } & {
                    id: string;
                    version: string;
                    status: string;
                    documentId: string;
                    uploadDate: Date;
                    renewalDate: Date | null;
                    updatedBy: string | null;
                    fileId: string | null;
                })[];
            } & {
                id: string;
                code: string;
                createdAt: Date;
                updatedAt: Date;
                name: string;
                procedureId: string;
            })[];
        };
        document: ({
            versions: ({
                file: {
                    id: string;
                    storageKey: string;
                    originalName: string;
                    mimeType: string;
                    size: number;
                    fileHash: string | null;
                    category: import("@prisma/client").$Enums.DocumentCategory;
                    entityType: string | null;
                    entityId: string | null;
                    title: string | null;
                    code: string | null;
                    version: string | null;
                    status: string | null;
                    owner: string | null;
                    nextReview: Date | null;
                    ragEnabled: boolean;
                    ragStatus: string | null;
                    aiSummary: string | null;
                    aiResume: string | null;
                    aiTags: string[];
                    aiProcessedAt: Date | null;
                    aiProcessingStatus: string | null;
                    embeddingStatus: string | null;
                    embeddingProcessedAt: Date | null;
                    resumeEmbedding: import("@prisma/client/runtime/client").JsonValue | null;
                    createdAt: Date;
                    updatedAt: Date;
                    aiDocType: string | null;
                    aiSafetyInstructions: string[];
                    aiEquipmentModels: string[];
                    aiPartNumbers: string[];
                    aiVendors: string[];
                    aiMaintenanceIntervals: string[];
                    aiTechnicalSpecs: string[];
                    aiProcedureNames: string[];
                } | null;
            } & {
                id: string;
                version: string;
                status: string;
                documentId: string;
                uploadDate: Date;
                renewalDate: Date | null;
                updatedBy: string | null;
                fileId: string | null;
            })[];
        } & {
            id: string;
            code: string;
            createdAt: Date;
            updatedAt: Date;
            name: string;
            procedureId: string;
        }) | null;
        currentVersion: {
            id: string;
            version: string;
            status: string;
            fileId: string | null;
            fileName: string;
            mimeType: string;
            file: {
                id: string;
                storageKey: string;
                originalName: string;
                mimeType: string;
                size: number;
                fileHash: string | null;
                category: import("@prisma/client").$Enums.DocumentCategory;
                entityType: string | null;
                entityId: string | null;
                title: string | null;
                code: string | null;
                version: string | null;
                status: string | null;
                owner: string | null;
                nextReview: Date | null;
                ragEnabled: boolean;
                ragStatus: string | null;
                aiSummary: string | null;
                aiResume: string | null;
                aiTags: string[];
                aiProcessedAt: Date | null;
                aiProcessingStatus: string | null;
                embeddingStatus: string | null;
                embeddingProcessedAt: Date | null;
                resumeEmbedding: import("@prisma/client/runtime/client").JsonValue | null;
                createdAt: Date;
                updatedAt: Date;
                aiDocType: string | null;
                aiSafetyInstructions: string[];
                aiEquipmentModels: string[];
                aiPartNumbers: string[];
                aiVendors: string[];
                aiMaintenanceIntervals: string[];
                aiTechnicalSpecs: string[];
                aiProcedureNames: string[];
            } | null;
            uploadDate: Date;
            renewalDate: Date | null;
            creator: string | null;
            updatedBy: string | null;
        } | null;
        previousVersion: {
            id: string;
            version: string;
            status: string;
            fileId: string | null;
            fileName: string;
            mimeType: string;
            file: {
                id: string;
                storageKey: string;
                originalName: string;
                mimeType: string;
                size: number;
                fileHash: string | null;
                category: import("@prisma/client").$Enums.DocumentCategory;
                entityType: string | null;
                entityId: string | null;
                title: string | null;
                code: string | null;
                version: string | null;
                status: string | null;
                owner: string | null;
                nextReview: Date | null;
                ragEnabled: boolean;
                ragStatus: string | null;
                aiSummary: string | null;
                aiResume: string | null;
                aiTags: string[];
                aiProcessedAt: Date | null;
                aiProcessingStatus: string | null;
                embeddingStatus: string | null;
                embeddingProcessedAt: Date | null;
                resumeEmbedding: import("@prisma/client/runtime/client").JsonValue | null;
                createdAt: Date;
                updatedAt: Date;
                aiDocType: string | null;
                aiSafetyInstructions: string[];
                aiEquipmentModels: string[];
                aiPartNumbers: string[];
                aiVendors: string[];
                aiMaintenanceIntervals: string[];
                aiTechnicalSpecs: string[];
                aiProcedureNames: string[];
            } | null;
            uploadDate: Date;
            renewalDate: Date | null;
            creator: string | null;
            updatedBy: string | null;
        } | null;
        reviewer: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        };
        responsible: {
            id: string;
            status: import("@prisma/client").$Enums.UserStatus;
            createdAt: Date;
            updatedAt: Date;
            organizationId: string;
            email: string;
            firebaseUid: string | null;
            firstName: string;
            lastName: string;
            avatar: string | null;
            phone: string | null;
            employeeId: string | null;
            position: string | null;
            signature: string | null;
            identityDocumentImage: string | null;
            identitySelfieImage: string | null;
            identityVerified: boolean;
            identityVerifiedAt: Date | null;
            identityApproved: boolean;
            identityApprovedAt: Date | null;
            identityProvider: string | null;
            identityCheckId: string | null;
            accessLevel: string | null;
            plantScope: string | null;
            processScope: string | null;
            subprocessScope: string | null;
            lastLogin: Date | null;
            loginAttempts: number;
            lockedUntil: Date | null;
            passwordHash: string | null;
            preferredLanguage: string;
            preferredTimezone: string;
        } | null;
    }>;
    listApprovals(params: {
        organizationId?: string;
        user?: any;
        status: ApprovalStatus;
        category?: ApprovalCategory;
        search?: string;
        limit?: number;
    }): Promise<ApprovalItem[]>;
}
